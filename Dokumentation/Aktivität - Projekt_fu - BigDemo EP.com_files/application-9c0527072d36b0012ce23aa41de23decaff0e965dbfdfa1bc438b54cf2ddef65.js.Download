var EasyToggler=new function(){var t=JSON.parse(localStorage.getItem("easy-toggle-state")||"{}"),e=function(){return localStorage.setItem("easy-toggle-state",JSON.stringify(t)),t},i=function(t){return t&&"none"===t.style.display},n=function(t){var n=t.parentNode;return n.classList.toggle("collapsed"),t.style.display=i(t)?"block":"none",t.id&&!!n.dataset.toggle&&e(),$(document).trigger("erui_interface_change_vertical"),t};this.toggle=function(e,o){if(!o||"A"!==o.target.tagName){var a="object"==typeof e?e:document.getElementById(e),s=a.id;s&&(t[s]?delete t[s]:t[s]=i(a)?0:1),n(a)}},this.ensureToggle=function(){for(var e=document.querySelectorAll("*[data-toggle]"),i=0;i<e.length;++i){var o=e.item(i),a=document.getElementById(o.dataset.toggle);t[o.dataset.toggle]&&n(a)}return this}};$(document).ready(EasyToggler.ensureToggle),function(t){"use strict";function e(e,o){this.element=e,this.options=t.extend({},n,o),this._defaults=n,this._name=i,this.init()}var i="entityArray",n={propertyName:"value"};e.prototype={init:function(){var e=this;this.entities={},this.element.addClass("entity-array"),this.createEmptyInput(),this.options.entities&&t.each(this.options.entities,function(){e.add(this)})},add:function(e){var i=this;return this.normalizeEntityData(e),!e.id||""===e||this.entities[e.id]?null:(e.element=t("<span/>").text(e.name).addClass(e.className||this.options.className).appendTo(this.element).after(" "),t("<input/>").attr("type","hidden").attr("name",this.options.inputNames).val(e.id).appendTo(e.element),t("<span/>").html("&nbsp;").addClass("icon icon-del").appendTo(e.element).data("entity-id",e.id).click(function(){i.removeEntity(t(this).data("entity-id"))}),this.entities[e.id]=e,this.removeEmptyInput(),e)},removeEntity:function(t){var e=this.entities[t];e.element.remove(),delete this.entities[t],0===Object.keys(this.entities).length&&this.createEmptyInput(),"function"==typeof this.options.afterRemove&&this.options.afterRemove(e)},clear:function(){for(var t in this.entities)this.removeEntity(t)},getValue:function(){return Object.keys(this.entities)},normalizeEntityData:function(t){t.id=t.id.toString(),t.name=t.name.toString()},createEmptyInput:function(){this.emptyInput=t("<input/>").attr("type","hidden").attr("name",this.options.inputNames).appendTo(this.element)},removeEmptyInput:function(){this.emptyInput&&(this.emptyInput.remove(),this.emptyInput=null)}},t.fn[i]=function(n,o){var a=null;return this.each(function(){var s=t.data(this,"plugin_"+i);s?a=s[n].call(s,o):t.data(this,"plugin_"+i,new e(t(this),n))}),null!==a?a:this}}(jQuery,window,document),REDMINE_EXTENSIONS={toggleDiv:function(t){var e;e="string"==typeof t?$("#"+t):t,e.toggleClass("collapsed").slideToggle("fast")},toggleDivAndChangeOpen:function(t,e){REDMINE_EXTENSIONS.toggleDiv(t),$(e).toggleClass("open")},toggleFilterButtons:function(t,e,i){var n=$("#"+t),o=$("#"+e),a=$("#"+i);o.hasClass("collapsed")&&a.hasClass("collapsed")?n.slideUp("slow"):n.slideDown("slow")}},function(t){function e(e,i){this.groupsContainer=t(e),this.options=t.extend({},o,i),this.loadUrl=i.loadUrl||e.data("url"),this.callback=i.callback,this.texts=this.options.texts,this.init()}function i(e,i){this.loader=e,this.header=i,this.header.data("group",this),this.group_name=this.header.data("group-name"),this.group_value=this.group_name,t.isArray(this.group_name)&&(this.group_name='["'+this.group_name.join('", "')+'"]'),this.count=parseInt(this.header.data("entity-count")),this.pages=this.header.data("pages")||1,this.loaded=this.header.hasClass("preloaded")}var n="easygrouploader";if(!t.fn[n]){var o={next_button_cols:1,load_opened:!1,load_limit:25,texts:{next:"Next"}};t.fn[n]=function(i){return t.each(t(this),function(){var o=t(this).data("plugin_"+n);if(o){if("string"==typeof i)switch(i){case"load_groups":o.options.load_opened&&o.load_all_groups()}}else o=new e(this,i),t(this).data("plugin_"+n,o)}),t(this)},e.prototype.init=function(){var e=this;this.groupsContainer.on("click",".group .expander",function(){var n=t(this).closest("tr.group"),o=n.data("group")||new i(e,n);o.loaded?(o.toggle(),"function"==typeof e.callback&&e.callback()):o.header.hasClass("group-loaded")||(o.load(),o.toggle())}),this.options.load_opened&&this.load_all_groups()},e.prototype.initInlineEdit=function(){t(".multieditable-container:not(.multieditable-initialized)",this.groupsContainer).each(function(){initInlineEditForContainer(this)}),initProjectEdit(),initEasyAutocomplete()},e.prototype.load_all_groups=function(){var e,n=this,o=[],a=0;t(".group",this.groupsContainer).not(".group-loaded").each(function(){e=t(this).data("group")||new i(n,t(this)),e.loaded||(o.push(e),a+=e.count),a>=n.options.load_limit&&(n.load_groups(o),a=0,o=[])}),o.length>0&&this.load_groups(o)},e.prototype.load_groups=function(e){var i=this,n=e.map(function(t){return t.group_value});t.ajax(this.loadUrl,{method:"GET",data:{group_to_load:n},success:function(n){var o="object"==typeof n?n:t.parseJSON(n);t.each(e,function(t,e){e.parseData(o[e.group_name]),e.toggle()}),i.initInlineEdit()}})},i.prototype.toggle=function(){EPExtensions.issuesToggleRowGroup(this.header)},i.prototype.load=function(){var e=this.header,i=this;e.hasClass("group-loaded")||(e.addClass("group-loaded"),t.ajax(this.loader.loadUrl,{method:"GET",data:{group_to_load:this.group_value},success:function(t){i.parseData(t),i.loader.initInlineEdit(),"function"==typeof i.loader.callback&&i.loader.callback()}}))},i.prototype.parseData=function(e){var i=this.header;this.rows=t(e),i.after(this.rows),i.data("group-page",1),this.loaded=!0,this.pages>1&&(this.createNextButton(),this.rows.filter("tr:last").after(this.next_button))},i.prototype.loadNext=function(){var e=this.header,i=e.data("group-page")+1,n=this;i<=this.pages&&t.ajax(this.loader.loadUrl,{method:"GET",data:{page:i,group_to_load:this.group_value},success:function(t){n.next_button.before(t),n.loader.initInlineEdit(),e.data("group-page",i),n.pages===i&&n.next_button.remove()}})},i.prototype.createNextButton=function(){var e=this.loader.loadUrl+(this.loader.loadUrl.indexOf("?")>=0?"&":"?")+t.param({group_to_load:this.group_value});this.next_link=t("<a>",{href:e,"class":"button"}).text(this.loader.texts.next).append(t("<i>",{"class":"icon-arrow"})),this.next_button=t("<tr/>",{"class":"easy-next-button"}).html(t("<td>",{colspan:this.loader.options.next_button_cols,"class":"text-center"}).html(this.next_link));var i=this;this.next_link.click(function(t){t.preventDefault(),i.loadNext()})}}}(jQuery),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),window.showFlashMessage=function(t,e,i){var n=$("#content");n.find(".flash").remove();var o=document.createElement("div");o.className="fixed flash "+t,o.style.position="fixed",o.style.zIndex="10001",o.style.right="5px",o.style.top="5px",o.setAttribute("onclick","closeFlashMessage($(this))");var a=document.createElement("a");a.className="icon-close close-icon",a.setAttribute("href","javascript:void(0)"),a.style["float"]="right",a.style.marginLeft="5px";var s=document.createElement("span");s.innerHTML=e,o.appendChild(a),o.appendChild(s),n.prepend(o);var l=$(o);return i&&setTimeout(function(){requestAnimFrame(function(){closeFlashMessage(l)})},i),l},window.closeFlashMessage=function(t){t.closest(".flash").fadeOut(500,function(){t.remove()})},function(t){t.widget("easy.easymultiselect",{options:{source:null,rootElement:null,selected:null,multiple:!0,preload:!0,position:{collision:"flip"},autofocus:!1,inputName:null,render_item:function(e,i){return t("<li>").data("item.autocomplete",i).text(i.label).appendTo(e)},activate_on_input_click:!0,load_immediately:!1,show_toggle_button:!0,select_first_value:!0,autocomplete_options:{}},_create:function(){this.selectedValues=this.options.selected,this._createUI(),this.expanded=!1,this.valuesLoaded=!1,this.afterLoaded=[],Array.isArray(this.options.source)?(this.options.preload=!0,this._initData(this.options.source)):this.options.preload&&this.options.load_immediately?this.load():this.selectedValues&&this.setValue(this.selectedValues)},_createUI:function(){var e=this;this.element.wrap('<span class="easy-autocomplete-tag"></span>'),this.tag=this.element.parent(),this.inputName=this.options.inputName||this.element.prop("name"),this.options.multiple?(this.valueElement=t("<span></span>"),this.tag.after(this.valueElement),this.options.show_toggle_button&&this._createToggleButton(),this.valueElement.entityArray({inputNames:this.inputName,afterRemove:function(){e.element.trigger("change")}})):(this.valueElement=t("<input>",{type:"hidden",name:this.inputName}),this.element.after(this.valueElement)),this._createAutocomplete(),this.options.multiple||this.element.css("margin-right",0)},_createToggleButton:function(){var e=this;this.link_ac_toggle=t("<a>").attr("class","icon icon-add clear-link"),this.link_ac_toggle.click(function(i){var n=t(this);i.preventDefault(),e.load(function(){select=t("<select>").prop("multiple",!0).prop("size",5).prop("name",e.inputName),t.each(e.possibleValues,function(i,n){option=t("<option>").prop("value",n.id).text(n.value),option.prop("selected",e.getValue().indexOf(n.id)>-1),select.append(option)}),$container=n.closest(".easy-multiselect-tag-container"),$container.find(":input").prop("disabled",!0),$container.children().hide(),$container.append(select),e.valueElement=select,e.expanded=!0})}),this.element.parent().addClass("input-append"),this.element.after(this.link_ac_toggle)},_createAutocomplete:function(){var e=this;e.element.autocomplete(t.extend({source:function(i,n){e.options.preload?e.load(function(){var o=new RegExp(t.ui.autocomplete.escapeRegex(i.term),"i");n(t.grep(e.possibleValues,function(t){return!i.term||o.test(t.value)}))},function(){n()}):"function"==typeof e.options.source?e.options.source(function(t){n(e.options.rootElement?t[e.options.rootElement]:t)}):t.getJSON(e.options.source,{term:i.term},function(t){n(e.options.rootElement?t[e.options.rootElement]:t)})},minLength:0,select:function(t,i){return e.selectValue(i.item),!1},change:function(i,n){n.item||(t(this).val(""),e.options.multiple||(e.valueElement.val(""),e.valueElement.change()))},position:this.options.position,autoFocus:this.options.autofocus},this.options.autocomplete_options)).data("ui-autocomplete")._renderItem=this.options.render_item,this.element.click(function(){t(this).select()}),this.options.activate_on_input_click&&this.element.on("click",function(){e.options.preload||e.element.focus().val(""),e.element.trigger("keydown"),e.element.autocomplete("search",e.element.val())}),t("<button type='button'>&nbsp;</button>").attr("tabIndex",-1).insertAfter(e.element).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").css("font-size","10px").css("margin-left",-1).click(function(){if(e.element.autocomplete("widget").is(":visible"))return e.element.autocomplete("close"),void e.element.blur();t(this).blur(),e.options.preload||e.element.focus().val(""),e.element.trigger("keydown"),e.element.autocomplete("search",e.element.val())})},_formatData:function(e){return t.map(e,function(t){var e,i;return t instanceof Array?(i=t[0],e=t[1]):t instanceof Object?(i=t.value,e=t.id):e=i=t,{value:i,id:e}})},_initData:function(t){this.possibleValues=this._formatData(t),this.valuesLoaded=!0,this.selectedValues=this.selectedValues?this.selectedValues:[],0==this.selectedValues.length&&this.options.preload&&this.options.select_first_value&&this.possibleValues.length>0&&this.selectedValues.push(this.possibleValues[0].id),this.setValue(this.selectedValues)},load:function(e,i){function n(t){var e=o.options.rootElement?t[o.options.rootElement]:t;!e&&window.console&&(console.warn("Data could not be loaded! Please check the datasource."),e=[]),o._initData(e);for(var i=o.afterLoaded.length-1;i>=0;i--)o.afterLoaded[i].call(o);o.loading=!1}var o=this;if(this.valuesLoaded)return void("function"==typeof e&&e());"function"==typeof e&&this.afterLoaded.push(e),this.loading||(this.loading=!0,"function"==typeof this.options.source?this.options.source(n):t.ajax(this.options.source,{dataType:"json",success:n,error:i}).always(function(){o.loading=!1}))},selectValue:function(t){this.options.multiple?(this.valueElement.entityArray("add",{id:t.id,name:t.value}),this.element.trigger("change"),this.element.val("")):(this.element.val(t.value),this.valueElement.val(t.id),this.valueElement.change(),this.element.change())},setValue:function(t){var e=this;if(void 0===t||!t)return!1;this.options.preload?this.load(function(){e.options.multiple&&e.valueElement.entityArray("clear"),e._setValues(t)}):(e.options.multiple&&e.valueElement.entityArray("clear"),e._setValues(t))},_setValues:function(t){var e=[];if(0==t.length)return!1;for(var i=t.length-1;i>=0;i--){if(t[i]instanceof Object&&!Array.isArray(t[i])&&null!==t[i])e.push(t[i]);else if(this.options.preload&&Array.isArray(this.possibleValues)){for(var n=this.possibleValues.length-1;n>=0;n--)if(t[i]==this.possibleValues[n].id||t[i]==this.possibleValues[n].id.toString()){e.push(this.possibleValues[n]);break}}else e.push({id:t[i],value:t[i]})}for(var i=e.length-1;i>=0;i--)this.options.multiple?this.valueElement.entityArray("add",{id:e[i].id,name:e[i].value}):(this.element.val(e[i].value),this.valueElement.val(e[i].id))},getValue:function(t){var e;return e=this.options.multiple&&!this.expanded?this.valueElement.entityArray("getValue"):this.options.multiple?this.valueElement.val():[this.valueElement.val()],t&&(e=this.possibleValues.filter(function(t){return e.indexOf(t.id)>=0})),e}})}(jQuery);